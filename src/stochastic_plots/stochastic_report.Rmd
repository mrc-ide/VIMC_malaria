---
title: 'VIMC stochastic diagnostic report: country'
output:
  html_document: 
    theme: united
    highlight: tango
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
library(scene)
library(ggpubr)
library(data.table)
library(dplyr)

#options(scipen = 999)

source('diagnostics.R')

#descriptive_dt<- readRDS('descriptive_dt.rds')
#input_data<- readRDS('input_data.rds')

# read in parameters
iso3c<- descriptive_dt$iso3c
scenario<- descriptive_dt$scenario
quick_run<- descriptive_dt$quick_run
description<- descriptive_dt$description

message('reading input')
processed_output<- input_data$processed_output
agg_output<- input_data$agg_output
coverage_data<- input_data$coverage_data
population_data<- input_data$population_data
site_data<- input_data$site_data

#find year where vaccine is introduced
intro_yr<- min(coverage_data[coverage!= 0, year])
```

## VIMC country-level diagnostic report


This is a diagnostic report for VIMC outputs for `r iso3c`, `r site_data$sites$country[1]`. 
The description for this model run is `r description`. The scenario ran was `r scenario`. For this run, quick_run was `r quick_run` .


## Vaccine coverage specified for scenario
```{r inputs}

plot_vaccine_coverage(coverage_data)


```

### Coverage of other interventions 
```{r intervention coverage, fig.height=10, fig.width= 15}
plot_interventions_combined(
  interventions = site_data$interventions,
  population = site_data$population,
  group_var = c("country", "name_1"),
  include = c("itn_use", "itn_input_dist", "tx_cov",'irs_cov', "smc_cov", "pmc_cov", "rtss_cov"),
  labels = c("ITN usage", "ITN model input", "Treatment", "IRS", "SMC", "PMC", "RTSS")
)


```


### Site file cases and deaths
```{r cases_deaths, echo=FALSE}

cases_deaths_diagnostic(site_data)


```


## Country population (VIMC)
```{r pop, echo=FALSE}

population_diagnostic_vimc(population_data)


```

## Modelled outputs

```{r population, echo=FALSE, fig.height=10, fig.width= 15}
output_diagnostic(agg_output, pg= 1, variable = 'cohort_size', intro_yr = intro_yr, summary = T)


output_diagnostic(processed_output,variable = 'cohort_size', pg= 1, intro_yr = intro_yr)
output_diagnostic(processed_output,variable = 'cohort_size', pg= 2, intro_yr = intro_yr)
output_diagnostic(processed_output,variable = 'cohort_size', pg= 3, intro_yr = intro_yr)
output_diagnostic(processed_output,variable = 'cohort_size', pg= 4, intro_yr = intro_yr)


```

# Incident cases
```{r incident cases, echo=FALSE, fig.height=10, fig.width= 15}
output_diagnostic(agg_output,variable = 'cases', pg= 1, intro_yr = intro_yr, summary = T)


scaling_diagnostic(agg_output)

output_diagnostic(processed_output, variable = 'cases', pg= 1, intro_yr = intro_yr)
output_diagnostic(processed_output, variable = 'cases', pg= 2, intro_yr = intro_yr)
output_diagnostic(processed_output, variable = 'cases', pg= 3, intro_yr = intro_yr)
output_diagnostic(processed_output, variable = 'cases', pg= 4, intro_yr = intro_yr)


```

#   Incidence rate 
```{r incidence rate, echo = FALSE, fig.height=10, fig.width= 10}
output_diagnostic(agg_output, variable = 'clinical', pg= 1, intro_yr = intro_yr, summary = T)

  
output_diagnostic(processed_output, variable = 'clinical', pg= 1, intro_yr = intro_yr)
output_diagnostic(processed_output, variable = 'clinical', pg= 2, intro_yr = intro_yr)
output_diagnostic(processed_output, variable = 'clinical', pg= 3, intro_yr = intro_yr)
output_diagnostic(processed_output, variable = 'clinical', pg= 4, intro_yr = intro_yr)

```

# Deaths

```{r deaths, echo=FALSE, fig.height=10, fig.width= 15}
output_diagnostic(agg_output, variable = 'deaths', pg= 1, intro_yr = intro_yr, summary = T)

output_diagnostic(processed_output,variable = 'deaths', pg= 1, intro_yr = intro_yr)
output_diagnostic(processed_output,variable = 'deaths', pg= 2, intro_yr = intro_yr)
output_diagnostic(processed_output,variable = 'deaths', pg= 3, intro_yr = intro_yr)
output_diagnostic(processed_output,variable = 'deaths', pg= 4, intro_yr = intro_yr)

```

# Mortality rate 
```{r mort rate, echo=FALSE, fig.height=10, fig.width= 15}
output_diagnostic(agg_output, variable = 'mortality', pg= 1, intro_yr = intro_yr, summary = T)


output_diagnostic(processed_output,variable = 'mortality',  pg= 1, intro_yr = intro_yr)
output_diagnostic(processed_output,variable = 'mortality',  pg= 2, intro_yr = intro_yr)
output_diagnostic(processed_output,variable = 'mortality',  pg= 3, intro_yr = intro_yr)
output_diagnostic(processed_output,variable = 'mortality',  pg= 4, intro_yr = intro_yr)

```

# DALYs
```{r dalys, echo = FALSE, fig.height=10, fig.width= 15}
output_diagnostic(agg_output, variable = 'dalys', pg = 1, intro_yr = intro_yr, summary = T)


output_diagnostic(processed_output, variable = 'dalys', pg = 1, intro_yr = intro_yr)
output_diagnostic(processed_output,variable = 'dalys',  pg = 2, intro_yr = intro_yr)
output_diagnostic(processed_output,variable = 'dalys',  pg = 3, intro_yr = intro_yr)
output_diagnostic(processed_output,variable = 'dalys',  pg = 4, intro_yr = intro_yr)

```

